//
//  StatementListInteractor.swift
//  TestSantander-IBM
//
//  Created by Erika Albizzati on 26/10/18.
//  Copyright (c) 2018 Erika Albizzati. All rights reserved.
//
//  This file was generated by the Clean Swift HELM Xcode Templates
//  https://github.com/HelmMobile/clean-swift-templates

protocol StatementListInteractorInput {
    func getStatements(request: StatementListScene.GetStatements.Request, completionHandler: @escaping (Bool, String?) -> Void)
}

protocol StatementListInteractorOutput {
    func presentStatements(response: StatementListScene.GetStatements.Response)
}

protocol StatementListDataSource {
    
}

protocol StatementListDataDestination {
    var user: UserAccount! { get set }
}

class StatementListInteractor: StatementListInteractorInput, StatementListDataSource, StatementListDataDestination {
    
    var output: StatementListInteractorOutput?
    var statements: [Statements] = []
    var user: UserAccount!

    // MARK: Business logic
    
    func getStatements(request: StatementListScene.GetStatements.Request, completionHandler: @escaping (Bool, String?) -> Void){
        
        HTTPClient.shared.fetchGenericData(urlString: "https://bank-app-test.herokuapp.com/api/statements/\(user.userId)", method: "GET", params: nil) { (api: ApiResponse?, err) in
            if err != nil {
                completionHandler(false, err)
            } else {
                
                guard let account = api?.statementList else {
                    completionHandler(false, "No Data")
                    return
                }
                for el in account {
                    self.statements.insert(el, at: 0)
                }
                
                let response = StatementListScene.GetStatements.Response(statements: account)
                self.output?.presentStatements(response: response)
                completionHandler(true, nil)
            }
        }
    }
}
