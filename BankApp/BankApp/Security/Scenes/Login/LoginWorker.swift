//
//  LoginWorker.swift
//  BankApp
//
//  Created by José Inácio Athayde Ferrarini on 17/03/20.
//  Copyright (c) 2020 br.com.solutis.inacioferrarini. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

class LoginWorker {

    func doLogin(with request: Login.Authentication.Request, completion: @escaping ((Result<Login.Authentication.Response?, Error>) -> Void)) {
        guard let apiUrl = URL(string: "https://bank-app-test.herokuapp.com/api/login") else { return }
        
        let parameters = "user=\(request.login)&password=\(request.password)"
        let bodyData = parameters.data(using: .utf8)
        
        var request = URLRequest(url: apiUrl)
        request.addValue("application/x-www-form-urlencoded", forHTTPHeaderField: "Content-Type")

        request.httpMethod = "POST"
        request.httpBody = bodyData

        URLSession.shared.dataTask(with: request) { data, _, error in
            if let error = error {
                DispatchQueue.main.async {
                    completion(.failure(error))
                }
            } else {
                var response: Login.Authentication.Response?
                if let data = data {
                    response <-- data
                }
                DispatchQueue.main.async {
                    completion(.success(response))
                }
            }
        }.resume()
    }

}
