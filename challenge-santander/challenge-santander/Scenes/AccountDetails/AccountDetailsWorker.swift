//
//  AccountDetailsWorker.swift
//  challenge-santander
//
//  Created by Hugo Ferreira on 18/05/20.
//  Copyright (c) 2020 Hugo Ferreira. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

protocol AccountDetailsWorkerLogic {
    func requestStatement(userId: Int, completionSuccess: @escaping ([AccountDetailsModel.AccountDetails]) -> Void, completionError: @escaping (Error) -> Void)
}

class AccountDetailsWorker : AccountDetailsWorkerLogic{

    func requestStatement(userId: Int, completionSuccess: @escaping ([AccountDetailsModel.AccountDetails]) -> Void, completionError: @escaping (Error) -> Void) {
         let urlBase = "https://bank-app-test.herokuapp.com/api/statements/\(userId)"
         guard let url = URL(string: urlBase) else { return }
         
         URLSession.shared.dataTask(with: url) { (data, response, error) in
             if let error = error {
                 DispatchQueue.main.async {
                     completionError(error)
                 }
             }
             
             if let data = data {
                 do{
                     let decoder = JSONDecoder()
                    let decodeData = try decoder.decode(AccountDetailsModel.RequestAccountDetails.self, from: data)
                     DispatchQueue.main.async {
                         completionSuccess((decodeData.accountDetails)!)
                     }
                 } catch {
                     print(error)
                 }
             }
         }.resume()
     }   
    
    
}
