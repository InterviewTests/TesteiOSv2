//
//  StatementsWorker.swift
//  BankApp-Desafio
//
//  Created by Mizia Lima on 2/26/21.
//  Copyright (c) 2021 ___ORGANIZATIONNAME___. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

class StatementsWorker {
    
    private let service: APIService
    
    init(service: APIService = APIService()) {
        self.service = service
    }
    
    //MARK: Worker
    func fetchStatementsList(completion: @escaping (Result<Statements.Response, ServiceError>) -> Void) {
        let url = URL(string: API.Path.statements)
        
        service.get(url: url) { (result) in
            switch result {
            case let .success(data):
                do {
                    let statement = try JSONDecoder().decode(StatementAPIModel.self, from: data)
                    let response = Statements.Response(statement: statement)
                    DispatchQueue.main.async {
                        completion(.success(response))
                    }
                } catch let error {
                    DispatchQueue.main.async {
                        completion(.failure(.unknown(error)))
                    }
                }
            case let .failure(error):
                DispatchQueue.main.async {
                    completion(.failure(error))
                }
            }
        }
    }
}
