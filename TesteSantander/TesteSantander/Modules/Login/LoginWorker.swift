//
//  LoginWorker.swift
//  TesteSantander
//
//  Created by Felipe Alexander Silva Melo on 28/05/19.
//  Copyright (c) 2019 Felipe Alexander Silva Melo. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit
import Moya
import RxSwift

class LoginWorker {
    let repository: APIRepository
    let disposeBag = DisposeBag()
    
    init() {
        let provider = MoyaProvider<APIRouter>()
        let service = APIServiceImpl(provider: provider)
        repository = APIRepositoryImpl(service: service)
    }
    
    func login(userFormFields: Login.UserFormFields, callback: @escaping (User) -> Void) {
        repository
            .login(user: userFormFields.user, password: userFormFields.password)
            .asObservable()
            .subscribe(onNext: { (user) in
                callback(user)
            }, onError: { (error) in
                print(error)
            })
            .disposed(by: disposeBag)
    }
}
