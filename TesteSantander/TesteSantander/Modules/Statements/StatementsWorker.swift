//
//  StatementsWorker.swift
//  TesteSantander
//
//  Created by Felipe Alexander Silva Melo on 29/05/19.
//  Copyright (c) 2019 Felipe Alexander Silva Melo. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit
import Moya
import RxSwift

class StatementsWorker {
    let repository: APIRepository
    let disposeBag = DisposeBag()
    
    init() {
        let provider = MoyaProvider<APIRouter>()
        let service = APIServiceImpl(provider: provider)
        repository = APIRepositoryImpl(service: service)
    }
    
    func fetchStatements(userId: Int, callback: @escaping (UserStatements) -> Void) {
        repository
            .fetchStatements(userId: userId)
            .asObservable()
            .subscribe(
                onNext: { (userStatements) in
                    callback(userStatements)
            },
                onError: { (error) in
                    print(error)
            }
            )
            .disposed(by: disposeBag)
    }
}
