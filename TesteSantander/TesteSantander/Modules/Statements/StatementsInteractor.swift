//
//  StatementsInteractor.swift
//  TesteSantander
//
//  Created by Felipe Alexander Silva Melo on 29/05/19.
//  Copyright (c) 2019 Felipe Alexander Silva Melo. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

protocol StatementsBusinessLogic {
    func fetchStatements()
}

protocol StatementsDataStore {
    var userAccount: UserAccount? { get set }
    var userStatements: UserStatements? { get set }
}

class StatementsInteractor: StatementsBusinessLogic, StatementsDataStore {
    var userAccount: UserAccount?
    var userStatements: UserStatements?
    
    var presenter: StatementsPresentationLogic?
    var worker: StatementsWorker?
    
    init() {
        worker = StatementsWorker()
    }
    
    func fetchStatements() {
        guard let userId = userAccount?.userId else {
            presenter?.displayErrorMessage(message: "ERROR: Could not get userId")
            return
        }
        
        worker?.fetchStatements(userId: userId, callback: { [weak self] (userStatements) in
            if let message = userStatements.error.message {
                self?.presenter?.displayErrorMessage(message: message)
            } else {
                self?.userStatements = userStatements
                let response = Statements.Statements.Response()
                self?.presenter?.displayStatements(response: response)
            }
        })
    }
}
