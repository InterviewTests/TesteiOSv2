//
//  HomeInteractorTests.swift
//  Bank
//
//  Created by Matheus Rodrigues Ribeiro on 27/04/20.
//  Copyright (c) 2020 Bank. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

@testable import TataSantanderBankTest
import XCTest

class HomeInteractorTests: XCTestCase
{
    // MARK: Subject under test

    var sut: HomeInteractor!
    let spy = HomePresentationLogicSpy()
    

    // MARK: Test lifecycle

    override func setUp()
    {
        super.setUp()
        setupHomeInteractor()
    }

    override func tearDown()
    {
        super.tearDown()
    }

    // MARK: Test setup

    func setupHomeInteractor()
    {
        sut = HomeInteractor()
        sut.worker = StatementsWorker(store: HomeServiceMock())
        sut.presenter = spy
        sut.userStore = UserServiceMock()
    }

    // MARK: Test doubles

    class HomePresentationLogicSpy: HomePresentationLogic
    {
        var statementsList: Home.StatementList.ViewModel?
        var error: Home.StatementList.Error?
        
        func presentStatements(response: Home.StatementList.ViewModel) {
            self.statementsList = response
        }

        func presentErrorToLoadStatements(error: Home.StatementList.Error) {
            self.error = error
        }
    }
  
    // MARK: Tests
    func testSucessLoadStatements() {
        sut.loadStatements(request: Home.StatementList.Request(userId: 1))
        XCTAssert(spy.statementsList != nil && spy.statementsList!.statements.count == 5)
    }
    
    func testFailLoadStatements() {
        sut.loadStatements(request: Home.StatementList.Request(userId: 2))
        XCTAssert(spy.statementsList == nil)
    }
    
    func testDoLogout() {
        sut.logout()
        XCTAssert(sut.userStore.fetchUser() != nil && sut.userStore.fetchUser() == "")
    }

}
